<!DOCTYPE html>
<html lang="es" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NutriScan - Reconocimiento de Alimentos</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#4CAF50">
    <meta name="description" content="Aplicación para reconocer alimentos y calcular calorías">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="NutriScan">
    
    <!-- PWA Icons -->
    <link rel="icon" type="image/png" sizes="192x192" href="img/icons/icon-192x192.png">
    <link rel="apple-touch-icon" href="img/icons/icon-192x192.png">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- PWA Builder Config -->
    <link rel="pwabuilder-config" href="pwabuilder-sw-config.json">
    
    <!-- TensorFlow.js y COCO-SSD para detección de objetos -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>
    
    <!-- MobileNet para clasificación avanzada de alimentos -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet"></script>
    
    <!-- Firebase App (la base principal de Firebase) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    
    <!-- Firebase Auth -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    
    <!-- Font Awesome para iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    
    <!-- Estilos -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header>
            <div class="header-logo">
                <h1>NutriScan</h1>
            </div>
            <div class="header-actions">
                <button id="menu-toggle-btn" class="icon-btn">
                    <i class="fas fa-bars"></i>
                </button>
                <div id="user-profile" class="user-profile">
                    <img id="user-avatar" src="img/avatar-placeholder.png" alt="Avatar de usuario">
                </div>
            </div>
        </header>

        <!-- Menú lateral -->
        <aside id="side-menu" class="side-menu">
            <div class="menu-header">
                <div id="menu-user-info" class="menu-user-info">
                    <img id="menu-user-avatar" src="img/avatar-placeholder.png" alt="Avatar">
                    <div class="user-details">
                        <span id="menu-user-name">Usuario</span>
                        <span id="menu-user-email">usuario@example.com</span>
                    </div>
                </div>
                <button id="menu-close-btn" class="icon-btn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <nav class="menu-nav">
                <ul>
                    <li><button data-screen="home-screen" class="menu-btn active"><i class="fas fa-home"></i> Inicio</button></li>
                    <li><button data-screen="scanner-screen" class="menu-btn"><i class="fas fa-camera"></i> Escanear alimento</button></li>
                    <li><button data-screen="barcode-screen" class="menu-btn"><i class="fas fa-barcode"></i> Escanear código</button></li>
                    <li><button data-screen="food-log-screen" class="menu-btn"><i class="fas fa-utensils"></i> Diario alimenticio</button></li>
                    <li><button data-screen="fitness-screen" class="menu-btn"><i class="fas fa-dumbbell"></i> Plan de fitness</button></li>
                    <li><button data-screen="workout-screen" class="menu-btn"><i class="fas fa-running"></i> Entrenamientos</button></li>
                    <li><button data-screen="stats-screen" class="menu-btn"><i class="fas fa-chart-pie"></i> Estadísticas</button></li>
                    <li><button data-screen="profile-screen" class="menu-btn"><i class="fas fa-user"></i> Perfil</button></li>
                    <li><button data-screen="settings-screen" class="menu-btn"><i class="fas fa-cog"></i> Configuración</button></li>
                    <li><button id="logout-btn" class="menu-btn logout-btn"><i class="fas fa-sign-out-alt"></i> Cerrar sesión</button></li>
                </ul>
            </nav>
        </aside>

        <!-- Navegación principal (móvil) -->
        <nav class="main-nav">
            <ul>
                <li><button data-screen="home-screen" class="nav-btn active"><i class="fas fa-home"></i><span>Inicio</span></button></li>
                <li><button data-screen="scanner-screen" class="nav-btn"><i class="fas fa-camera"></i><span>Escanear</span></button></li>
                <li><button data-screen="food-log-screen" class="nav-btn"><i class="fas fa-utensils"></i><span>Diario</span></button></li>
                <li><button data-screen="fitness-screen" class="nav-btn"><i class="fas fa-dumbbell"></i><span>Fitness</span></button></li>
                <li><button data-screen="profile-screen" class="nav-btn"><i class="fas fa-user"></i><span>Perfil</span></button></li>
            </ul>
        </nav>

        <!-- Contenido principal -->
        <main>
            <!-- Pantalla de carga -->
            <section id="loading-screen" class="screen">
                <div class="loading-container">
                    <div class="spinner-large"></div>
                    <h2>Cargando NutriScan</h2>
                    <p>Por favor, espera un momento mientras preparamos todo...</p>
                </div>
            </section>
            
            <!-- Pantalla de error -->
            <section id="error-screen" class="screen">
                <div class="error-container">
                    <i class="fas fa-exclamation-triangle error-icon"></i>
                    <h2>¡Ups! Algo salió mal</h2>
                    <p id="error-message">No se pudo cargar la aplicación</p>
                    <button id="retry-btn" class="primary-btn">
                        <i class="fas fa-redo"></i> Intentar de nuevo
                    </button>
                </div>
            </section>
            
            <!-- Pantalla de login -->
            <section id="login-screen" class="screen">
                <div class="login-container">
                    <div class="logo-container">
                        <img src="img/logo.png" alt="NutriScan Logo" class="app-logo">
                        <h1>NutriScan</h1>
                        <p>Tu asistente personal de nutrición y fitness</p>
                    </div>
                    
                    <div class="auth-options">
                        <button id="google-login-btn" class="auth-btn google-btn">
                            <i class="fab fa-google"></i> Iniciar sesión con Google
                        </button>
                        <button id="email-login-toggle" class="auth-btn email-btn">
                            <i class="fas fa-envelope"></i> Iniciar sesión con email
                        </button>
                        <button id="guest-login-btn" class="auth-btn guest-btn">
                            <i class="fas fa-user"></i> Continuar como invitado
                        </button>
                    </div>
                    
                    <div id="email-login-form" class="login-form hidden">
                        <div class="form-group">
                            <label for="login-email">Correo electrónico</label>
                            <input type="email" id="login-email" placeholder="correo@ejemplo.com">
                        </div>
                        <div class="form-group">
                            <label for="login-password">Contraseña</label>
                            <input type="password" id="login-password" placeholder="Contraseña">
                        </div>
                        <button id="login-submit-btn" class="auth-btn primary-btn">Iniciar sesión</button>
                        <p class="form-link">¿No tienes cuenta? <a id="register-toggle" href="#">Registrarse</a></p>
                        <p class="form-link"><a id="forgot-password-link" href="#">Olvidé mi contraseña</a></p>
                    </div>
                    
                    <div id="register-form" class="login-form hidden">
                        <div class="form-group">
                            <label for="register-name">Nombre</label>
                            <input type="text" id="register-name" placeholder="Tu nombre">
                        </div>
                        <div class="form-group">
                            <label for="register-email">Correo electrónico</label>
                            <input type="email" id="register-email" placeholder="correo@ejemplo.com">
                        </div>
                        <div class="form-group">
                            <label for="register-password">Contraseña</label>
                            <input type="password" id="register-password" placeholder="Contraseña">
                        </div>
                        <div class="form-group">
                            <label for="register-confirm-password">Confirmar contraseña</label>
                            <input type="password" id="register-confirm-password" placeholder="Confirma tu contraseña">
                        </div>
                        <button id="register-submit-btn" class="auth-btn primary-btn">Registrarse</button>
                        <p class="form-link">¿Ya tienes cuenta? <a id="login-toggle" href="#">Iniciar sesión</a></p>
                    </div>
                    
                    <div class="login-footer">
                        <p>Al iniciar sesión aceptas nuestros <a href="#">Términos de servicio</a> y <a href="#">Política de privacidad</a></p>
                    </div>
                </div>
            </section>
            
            <!-- Pantalla de inicio (dashboard) -->
            <section id="home-screen" class="screen">
                <div class="dashboard-container">
                    <div class="welcome-section">
                        <h2>Bienvenido, <span id="user-name-display">Usuario</span></h2>
                        <p>¿Qué deseas hacer hoy?</p>
                    </div>
                    
                    <div class="daily-summary">
                        <h3>Resumen de hoy</h3>
                        <div class="summary-cards">
                            <div class="summary-card">
                                <div class="card-icon"><i class="fas fa-fire"></i></div>
                                <div class="card-info">
                                    <span class="card-value" id="today-calories">0/2000</span>
                                    <span class="card-label">Calorías</span>
                                </div>
                                <div class="progress-bar" id="calories-progress">
                                    <div class="progress" style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="summary-card">
                                <div class="card-icon"><i class="fas fa-walking"></i></div>
                                <div class="card-info">
                                    <span class="card-value" id="today-activity">0/300</span>
                                    <span class="card-label">Actividad (kcal)</span>
                                </div>
                                <div class="progress-bar" id="activity-progress">
                                    <div class="progress" style="width: 0%"></div>
                                </div>
                            </div>
                            <div class="summary-card">
                                <div class="card-icon"><i class="fas fa-tint"></i></div>
                                <div class="card-info">
                                    <span class="card-value" id="today-water">0/2000</span>
                                    <span class="card-label">Agua (ml)</span>
                                </div>
                                <div class="progress-bar" id="water-progress">
                                    <div class="progress" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="quick-actions">
                        <h3>Acciones rápidas</h3>
                        <div class="action-buttons">
                            <button id="quick-scan-btn" class="action-btn">
                                <i class="fas fa-camera"></i>
                                <span>Escanear alimento</span>
                            </button>
                            <button id="quick-log-btn" class="action-btn">
                                <i class="fas fa-utensils"></i>
                                <span>Registrar comida</span>
                            </button>
                            <button id="quick-workout-btn" class="action-btn">
                                <i class="fas fa-dumbbell"></i>
                                <span>Comenzar entrenamiento</span>
                            </button>
                            <button id="quick-water-btn" class="action-btn">
                                <i class="fas fa-tint"></i>
                                <span>Registrar agua</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="recommendations-section">
                        <h3>Recomendaciones</h3>
                        <div id="recommendations-container" class="recommendations-container">
                            <!-- Contenido generado dinámicamente -->
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Pantalla de escáner de alimentos -->
            <section id="scanner-screen" class="screen">
                <div class="camera-container">
                    <video id="camera-view" autoplay playsinline></video>
                    <canvas id="camera-canvas"></canvas>
                    
                    <!-- Indicador de carga para el modelo -->
                    <div id="model-loading" class="loading-model">
                        <div class="spinner"></div>
                        <p>Cargando modelo de detección...</p>
                    </div>
                </div>
                
                <div class="camera-controls">
                    <button id="capture-btn" class="primary-btn">
                        <i class="fas fa-camera"></i> Capturar
                    </button>
                </div>
                
                <div class="detection-results"></div>
            </section>
            
            <!-- Pantalla de escáner de códigos de barras -->
            <section id="barcode-screen" class="screen">
                <div class="camera-container">
                    <video id="barcode-view" autoplay playsinline></video>
                    <canvas id="barcode-canvas"></canvas>
                    
                    <div class="barcode-guide">
                        <div class="barcode-frame"></div>
                        <p>Apunta al código de barras</p>
                    </div>
                </div>
                
                <div class="camera-controls">
                    <button id="manual-barcode-btn" class="secondary-btn">
                        <i class="fas fa-keyboard"></i> Introducir manualmente
                    </button>
                </div>
            </section>
            
            <!-- Pantalla de resultado de reconocimiento -->
            <section id="result-screen" class="screen">
                <div class="result-container">
                    <div class="result-image-container">
                        <img id="captured-image" src="" alt="Imagen capturada">
                    </div>
                    
                    <div class="food-info">
                        <h2 id="food-name">Nombre del alimento</h2>
                        <div class="nutrition-summary">
                            <div class="nutrition-item">
                                <span class="nutrition-value" id="calories-value">--</span>
                                <span class="nutrition-label">Calorías</span>
                            </div>
                            <div class="nutrition-item">
                                <span class="nutrition-value" id="protein-value">--</span>
                                <span class="nutrition-label">Proteína</span>
                            </div>
                            <div class="nutrition-item">
                                <span class="nutrition-value" id="carbs-value">--</span>
                                <span class="nutrition-label">Carbohidratos</span>
                            </div>
                            <div class="nutrition-item">
                                <span class="nutrition-value" id="fat-value">--</span>
                                <span class="nutrition-label">Grasas</span>
                            </div>
                        </div>
                        
                        <div class="food-details" id="food-details">
                            <!-- Detalles del alimento -->
                        </div>
                        
                        <div class="action-buttons">
                            <button id="add-to-diary-btn" class="primary-btn">
                                <i class="fas fa-plus"></i> Añadir al diario
                            </button>
                            <button id="scan-again-btn" class="secondary-btn">
                                <i class="fas fa-redo"></i> Escanear otro
                            </button>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Pantalla de información del producto escaneado por código de barras -->
            <section id="product-info-screen" class="screen">
                <div class="product-container">
                    <div class="product-header">
                        <div class="product-image-container">
                            <img id="product-image" src="" alt="Imagen del producto">
                        </div>
                        <div class="product-title">
                            <h2 id="product-name">Nombre del producto</h2>
                            <p id="product-brand">Marca</p>
                        </div>
                    </div>
                    
                    <div class="product-details">
                        <div class="detail-section">
                            <h3>Información nutricional</h3>
                            <div id="product-calories" class="calories-badge">-- kcal</div>
                            <div id="product-nutrients" class="nutrients-container">
                                <!-- Información nutricional -->
                            </div>
                        </div>
                        
                        <div class="detail-section">
                            <h3>Alérgenos e información dietética</h3>
                            <div id="product-allergens" class="allergens-container">
                                <!-- Información de alérgenos -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="action-buttons">
                        <button id="add-product-to-diary-btn" class="primary-btn">
                            <i class="fas fa-plus"></i> Añadir al diario
                        </button>
                        <button id="scan-another-btn" class="secondary-btn">
                            <i class="fas fa-barcode"></i> Escanear otro
                        </button>
                    </div>
                </div>
            </section>
            
            <!-- Pantalla para añadir alimento al registro diario -->
            <section id="add-to-log-screen" class="screen">
                <div class="add-to-log-container">
                    <h2>Añadir a diario</h2>
                    <p>Añadir <span id="log-food-name">alimento</span> a:</p>
                    
                    <div class="meal-type-options">
                        <button class="meal-type-btn" data-meal-type="breakfast">
                            <i class="fas fa-coffee"></i>
                            <span>Desayuno</span>
                        </button>
                        <button class="meal-type-btn" data-meal-type="lunch">
                            <i class="fas fa-hamburger"></i>
                            <span>Almuerzo</span>
                        </button>
                        <button class="meal-type-btn" data-meal-type="dinner">
                            <i class="fas fa-utensils"></i>
                            <span>Cena</span>
                        </button>
                        <button class="meal-type-btn" data-meal-type="snack">
                            <i class="fas fa-cookie"></i>
                            <span>Snack</span>
                        </button>
                    </div>
                    
                    <div class="portion-selector">
                        <label for="portion-size">Tamaño de porción:</label>
                        <div class="portion-controls">
                            <button class="portion-btn" data-action="decrease">-</button>
                            <input type="number" id="portion-size" value="1" min="0.25" step="0.25">
                            <button class="portion-btn" data-action="increase">+</button>
                        </div>
                    </div>
                    
                    <div class="action-buttons">
                        <button id="cancel-add-log-btn" class="secondary-btn">
                            <i class="fas fa-times"></i> Cancelar
                        </button>
                    </div>
                </div>
            </section>
            
            <!-- Pantalla de diario alimenticio -->
            <section id="food-log-screen" class="screen">
                <div class="date-selector">
                    <button id="prev-day-btn" class="icon-btn">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <div id="current-date">Hoy</div>
                    <button id="next-day-btn" class="icon-btn">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
                
                <div id="daily-log-container" class="daily-log">
                    <!-- El contenido del registro diario se generará dinámicamente -->
                </div>
                
                <div class="add-food-fab">
                    <button id="add-food-btn" class="fab-btn">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
            </section>
            
            <!-- Pantalla de estadísticas -->
            <section id="stats-screen" class="screen">
                <div class="stats-container">
                    <div class="stats-header">
                        <h2>Estadísticas</h2>
                        <div class="period-selector">
                            <button data-period="7" class="period-btn active">Semana</button>
                            <button data-period="30" class="period-btn">Mes</button>
                            <button data-period="90" class="period-btn">3 Meses</button>
                        </div>
                    </div>
                    
                    <div class="stats-section">
                        <h3>Consumo de calorías</h3>
                        <div class="chart-container" id="calories-chart">
                            <!-- Gráfico de calorías -->
                        </div>
                        <div class="stats-summary" id="calories-summary">
                            <!-- Resumen de calorías -->
                        </div>
                    </div>
                    
                    <div class="stats-section">
                        <h3>Distribución de macronutrientes</h3>
                        <div class="chart-container" id="macros-chart">
                            <!-- Gráfico de macronutrientes -->
                        </div>
                    </div>
                    
                    <div class="stats-section">
                        <h3>Categorías de alimentos</h3>
                        <div class="chart-container" id="categories-chart">
                            <!-- Gráfico de categorías -->
                        </div>
                    </div>
                    
                    <div class="stats-section">
                        <h3>Tendencias y análisis</h3>
                        <div id="trends-analysis" class="trends-container">
                            <!-- Análisis de tendencias -->
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Pantalla de Fitness y Plan de Entrenamiento -->
            <section id="fitness-screen" class="screen">
                <div class="fitness-container">
                    <div class="fitness-header">
                        <h2>Tu Plan de Fitness</h2>
                        <div class="fitness-goal">
                            <p>Objetivo actual: <span id="current-fitness-goal">No definido</span></p>
                            <button id="change-goal-btn" class="text-btn">
                                <i class="fas fa-edit"></i> Cambiar objetivo
                            </button>
                        </div>
                    </div>
                    
                    <div class="fitness-summary">
                        <div class="summary-cards">
                            <div class="summary-card">
                                <div class="card-icon"><i class="fas fa-dumbbell"></i></div>
                                <div class="card-info">
                                    <span class="card-value" id="workouts-completed">0/4</span>
                                    <span class="card-label">Entrenamientos esta semana</span>
                                </div>
                            </div>
                            <div class="summary-card">
                                <div class="card-icon"><i class="fas fa-fire-alt"></i></div>
                                <div class="card-info">
                                    <span class="card-value" id="weekly-activity-calories">0/2100</span>
                                    <span class="card-label">Calorías quemadas (semana)</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="fitness-section">
                        <h3>Recomendaciones de entrenamiento</h3>
                        <div id="workout-recommendations" class="workout-recommendations">
                            <!-- Contenido generado dinámicamente -->
                        </div>
                    </div>
                    
                    <div class="fitness-section">
                        <h3>Plan semanal</h3>
                        <div id="weekly-plan" class="weekly-plan">
                            <!-- Contenido generado dinámicamente -->
                        </div>
                    </div>
                    
                    <div class="fitness-section">
                        <h3>Balance de nutrición y actividad</h3>
                        <div id="nutrition-activity-balance" class="balance-chart">
                            <!-- Gráfico de balance -->
                        </div>
                        <div id="balance-analysis" class="balance-analysis">
                            <!-- Análisis de balance -->
                        </div>
                    </div>
                    
                    <div class="action-buttons">
                        <button id="start-workout-btn" class="primary-btn">
                            <i class="fas fa-play"></i> Comenzar entrenamiento
                        </button>
                        <button id="customize-plan-btn" class="secondary-btn">
                            <i class="fas fa-cog"></i> Personalizar plan
                        </button>
                    </div>
                </div>
            </section>
            
            <!-- Pantalla de Entrenamientos -->
            <section id="workout-screen" class="screen">
                <div class="workout-container">
                    <div class="workout-header">
                        <h2>Entrenamientos</h2>
                        <div class="workout-filters">
                            <button data-filter="all" class="filter-btn active">Todos</button>
                            <button data-filter="cardio" class="filter-btn">Cardio</button>
                            <button data-filter="strength" class="filter-btn">Fuerza</button>
                            <button data-filter="flexibility" class="filter-btn">Flexibilidad</button>
                            <button data-filter="hiit" class="filter-btn">HIIT</button>
                        </div>
                    </div>
                    
                    <div id="workouts-list" class="workouts-list">
                        <!-- Lista de entrenamientos generada dinámicamente -->
                    </div>
                    
                    <div class="workout-history">
                        <h3>Historial de entrenamientos</h3>
                        <div id="workout-history-list" class="history-list">
                            <!-- Historial generado dinámicamente -->
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Pantalla de perfil de usuario -->
            <section id="profile-screen" class="screen">
                <div class="screen-header">
                    <h2>Mi Perfil</h2>
                </div>
                <div class="profile-container">
                    <div class="profile-section">
                        <div class="profile-header">
                            <h3>Mi Perfil</h3>
                            <button id="edit-profile-btn" class="edit-btn"><i class="fas fa-edit"></i></button>
                        </div>
                        <div class="profile-content">
                            <div class="profile-avatar">
                                <i class="fas fa-user-circle"></i>
                            </div>
                            <div class="profile-info">
                                <h4 id="profile-name">Usuario</h4>
                                <p id="profile-physical-details">Completa tu perfil para recibir recomendaciones personalizadas</p>
                                <p>Nivel de actividad: <span id="profile-activity-level-display">No especificado</span></p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="profile-section">
                        <div class="profile-header">
                            <h3>Objetivo Fitness</h3>
                            <button id="edit-goals-btn" class="edit-btn"><i class="fas fa-edit"></i></button>
                        </div>
                        <div class="profile-content">
                            <div class="goal-summary">
                                <div class="goal-item">
                                    <i class="fas fa-bullseye"></i>
                                    <div>
                                        <small>Objetivo primario</small>
                                        <h4 id="fitness-goal-display">No especificado</h4>
                                    </div>
                                </div>
                                <div class="goal-item">
                                    <i class="fas fa-weight"></i>
                                    <div>
                                        <small>Peso objetivo</small>
                                        <h4 id="weight-goal-display">No especificado</h4>
                                    </div>
                                </div>
                                <div class="goal-item">
                                    <i class="fas fa-fire"></i>
                                    <div>
                                        <small>Objetivo calórico</small>
                                        <h4 id="calorie-goal-display">No calculado</h4>
                                    </div>
                                </div>
                                <div class="goal-item">
                                    <i class="fas fa-dumbbell"></i>
                                    <div>
                                        <small>Entrenamientos</small>
                                        <h4 id="workout-frequency-display">No especificado</h4>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="profile-section">
                        <div class="profile-header">
                            <h3>Objetivos nutricionales</h3>
                            <button id="edit-nutrition-btn" class="edit-btn"><i class="fas fa-edit"></i></button>
                        </div>
                        <div class="profile-content">
                            <div class="nutrition-summary">
                                <div class="nutrition-item">
                                    <div class="nutrition-label">Calorías</div>
                                    <div class="nutrition-value" id="cal-goal-display">2000 kcal</div>
                                </div>
                                <div class="nutrition-item">
                                    <div class="nutrition-label">Proteínas</div>
                                    <div class="nutrition-value" id="protein-goal-display">100g</div>
                                </div>
                                <div class="nutrition-item">
                                    <div class="nutrition-label">Carbohidratos</div>
                                    <div class="nutrition-value" id="carbs-goal-display">250g</div>
                                </div>
                                <div class="nutrition-item">
                                    <div class="nutrition-label">Grasas</div>
                                    <div class="nutrition-value" id="fat-goal-display">65g</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="profile-section">
                        <div class="profile-header">
                            <h3>Preferencias dietéticas</h3>
                            <button id="edit-diet-btn" class="edit-btn"><i class="fas fa-edit"></i></button>
                        </div>
                        <div class="profile-content">
                            <div class="diet-tags" id="diet-preferences-container">
                                <span class="diet-tag" id="vegetarian-tag" style="display: none;">Vegetariano</span>
                                <span class="diet-tag" id="vegan-tag" style="display: none;">Vegano</span>
                                <span class="diet-tag" id="gluten-free-tag" style="display: none;">Sin gluten</span>
                                <span class="diet-tag" id="lactose-free-tag" style="display: none;">Sin lactosa</span>
                                <span class="diet-tag" id="no-diet-tag">Sin preferencias dietéticas</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="profile-section">
                        <div class="profile-header">
                            <h3>Alérgenos</h3>
                            <button id="edit-allergens-btn" class="edit-btn"><i class="fas fa-edit"></i></button>
                        </div>
                        <div class="profile-content">
                            <div class="allergens-container" id="allergens-container">
                                <p id="no-allergens-msg">No se han registrado alérgenos</p>
                            </div>
                        </div>
                    </div>
                    
                    <button id="logout-btn" class="logout-btn">
                        <i class="fas fa-sign-out-alt"></i> Cerrar sesión
                    </button>
                </div>
            </section>
            
            <!-- Pantalla de configuración -->
            <section id="settings-screen" class="screen">
                <div class="settings-container">
                    <h2>Configuración</h2>
                    
                    <div class="settings-section">
                        <h3>Apariencia</h3>
                        <div class="setting-item">
                            <label for="theme-selector">Tema</label>
                            <select id="theme-selector" class="setting-control">
                                <option value="light">Claro</option>
                                <option value="dark">Oscuro</option>
                                <option value="system">Sistema</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="settings-section">
                        <h3>Notificaciones</h3>
                        <div class="setting-item">
                            <label for="notifications-toggle">Activar notificaciones</label>
                            <div class="toggle-switch">
                                <input type="checkbox" id="notifications-toggle" checked>
                                <span class="toggle-slider"></span>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <label for="meal-reminders-toggle">Recordatorios de comidas</label>
                            <div class="toggle-switch">
                                <input type="checkbox" id="meal-reminders-toggle" checked>
                                <span class="toggle-slider"></span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="settings-section">
                        <h3>Escáner</h3>
                        <div class="setting-item">
                            <label for="auto-detection-toggle">Detección automática</label>
                            <div class="toggle-switch">
                                <input type="checkbox" id="auto-detection-toggle" checked>
                                <span class="toggle-slider"></span>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <label for="sound-feedback-toggle">Retroalimentación sonora</label>
                            <div class="toggle-switch">
                                <input type="checkbox" id="sound-feedback-toggle" checked>
                                <span class="toggle-slider"></span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="settings-section">
                        <h3>Datos</h3>
                        <button id="export-data-btn" class="secondary-btn">
                            <i class="fas fa-download"></i> Exportar datos
                        </button>
                        <button id="import-data-btn" class="secondary-btn">
                            <i class="fas fa-upload"></i> Importar datos
                        </button>
                        <button id="clear-data-btn" class="danger-btn">
                            <i class="fas fa-trash"></i> Borrar todos los datos
                        </button>
                    </div>
                    
                    <div class="settings-section">
                        <h3>Acerca de</h3>
                        <p>NutriScan v1.0</p>
                        <p>Desarrollado por Adrian Alcaide</p>
                        <button id="feedback-btn" class="text-btn">
                            <i class="fas fa-comment"></i> Enviar comentarios
                        </button>
                    </div>
                </div>
            </section>
        </main>

        <!-- Mensaje de notificación -->
        <div id="notification" class="notification">
            <span id="notification-text"></span>
        </div>
        
        <!-- Overlay para modales -->
        <div id="modal-overlay" class="modal-overlay"></div>
        
        <!-- Modal para selección de objetivo fitness -->
        <div id="fitness-goal-modal" class="modal">
            <div class="modal-header">
                <h3>Selecciona tu objetivo de fitness</h3>
                <button class="modal-close-btn"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-content">
                <div class="goal-options">
                    <div class="goal-option" data-goal="weightLoss">
                        <i class="fas fa-weight"></i>
                        <h4>Pérdida de peso</h4>
                        <p>Reduce grasa corporal manteniendo masa muscular</p>
                    </div>
                    <div class="goal-option" data-goal="muscleGain">
                        <i class="fas fa-dumbbell"></i>
                        <h4>Ganancia muscular</h4>
                        <p>Incrementa masa muscular y fuerza</p>
                    </div>
                    <div class="goal-option" data-goal="maintenance">
                        <i class="fas fa-balance-scale"></i>
                        <h4>Mantenimiento</h4>
                        <p>Mantén tu peso y composición corporal actual</p>
                    </div>
                    <div class="goal-option" data-goal="athleticPerformance">
                        <i class="fas fa-running"></i>
                        <h4>Rendimiento atlético</h4>
                        <p>Mejora tu rendimiento deportivo</p>
                    </div>
                    <div class="goal-option" data-goal="healthImprovement">
                        <i class="fas fa-heartbeat"></i>
                        <h4>Mejora de salud</h4>
                        <p>Enfócate en mejorar indicadores de salud</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="goal-cancel-btn" class="secondary-btn">Cancelar</button>
                <button id="goal-save-btn" class="primary-btn">Guardar objetivo</button>
            </div>
        </div>
        
        <!-- Modal para editar perfil -->
        <div id="edit-profile-modal" class="modal">
            <div class="modal-header">
                <h3>Editar perfil</h3>
                <button class="modal-close-btn"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-content">
                <div class="profile-form">
                    <div class="form-group">
                        <label for="profile-name">Nombre</label>
                        <input type="text" id="profile-name-input" placeholder="Tu nombre">
                    </div>
                    
                    <div class="form-group">
                        <label for="profile-gender">Género</label>
                        <select id="profile-gender">
                            <option value="">Seleccionar</option>
                            <option value="male">Masculino</option>
                            <option value="female">Femenino</option>
                            <option value="other">Otro</option>
                            <option value="prefer-not-to-say">Prefiero no decirlo</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="profile-birthdate">Fecha de nacimiento</label>
                        <input type="date" id="profile-birthdate">
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group half">
                            <label for="profile-height">Altura (cm)</label>
                            <input type="number" id="profile-height" min="100" max="250" step="1" placeholder="175">
                        </div>
                        
                        <div class="form-group half">
                            <label for="profile-weight">Peso (kg)</label>
                            <input type="number" id="profile-weight" min="30" max="300" step="0.1" placeholder="70">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="profile-activity-level">Nivel de actividad</label>
                        <select id="profile-activity-level">
                            <option value="sedentary">Sedentario (poco o nada de ejercicio)</option>
                            <option value="light">Levemente activo (ejercicio ligero 1-3 días/semana)</option>
                            <option value="moderate">Moderadamente activo (ejercicio moderado 3-5 días/semana)</option>
                            <option value="active">Muy activo (ejercicio intenso 6-7 días/semana)</option>
                            <option value="extremely">Extremadamente activo (ejercicio muy intenso o trabajo físico)</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="profile-cancel-btn" class="secondary-btn">Cancelar</button>
                <button id="profile-save-btn" class="primary-btn">Guardar cambios</button>
            </div>
        </div>
        
        <!-- Modal para editar objetivos nutricionales -->
        <div id="edit-goals-modal" class="modal">
            <div class="modal-header">
                <h3>Ajustar objetivos nutricionales</h3>
                <button class="modal-close-btn"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-content">
                <div class="goals-form">
                    <div class="goal-section">
                        <h4>Objetivo de fitness</h4>
                        <div class="form-group">
                            <label for="fitness-goal-select">Objetivo primario</label>
                            <select id="fitness-goal-select">
                                <option value="weightLoss">Pérdida de peso</option>
                                <option value="muscleGain">Ganancia muscular</option>
                                <option value="maintenance">Mantenimiento</option>
                                <option value="athleticPerformance">Rendimiento atlético</option>
                                <option value="healthImprovement">Mejora de salud</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="fitness-level">Nivel de fitness</label>
                            <select id="fitness-level">
                                <option value="beginner">Principiante</option>
                                <option value="intermediate">Intermedio</option>
                                <option value="advanced">Avanzado</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="workout-frequency">Frecuencia de entrenamiento (días/semana)</label>
                            <select id="workout-frequency">
                                <option value="2">2 días</option>
                                <option value="3">3 días</option>
                                <option value="4">4 días</option>
                                <option value="5">5 días</option>
                                <option value="6">6 días</option>
                                <option value="7">7 días</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="goal-section">
                        <h4>Objetivos de peso</h4>
                        <div class="form-group">
                            <label for="target-weight">Peso objetivo (kg)</label>
                            <input type="number" id="target-weight" min="30" max="200" step="0.1">
                        </div>
                        
                        <div class="form-group">
                            <label for="weekly-change">Cambio semanal (kg)</label>
                            <select id="weekly-change">
                                <option value="0.25">0.25 kg por semana (gradual)</option>
                                <option value="0.5">0.5 kg por semana (moderado)</option>
                                <option value="0.75">0.75 kg por semana (acelerado)</option>
                                <option value="1">1 kg por semana (intenso)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="goal-section">
                        <h4>Distribución de macronutrientes</h4>
                        <div class="macro-sliders">
                            <div class="form-group">
                                <label for="protein-percent">Proteínas: <span id="protein-value">30</span>%</label>
                                <input type="range" id="protein-percent" min="10" max="50" value="30">
                            </div>
                            
                            <div class="form-group">
                                <label for="carbs-percent">Carbohidratos: <span id="carbs-value">45</span>%</label>
                                <input type="range" id="carbs-percent" min="20" max="70" value="45">
                            </div>
                            
                            <div class="form-group">
                                <label for="fat-percent">Grasas: <span id="fat-value">25</span>%</label>
                                <input type="range" id="fat-percent" min="10" max="50" value="25">
                            </div>
                        </div>
                        <div class="macro-total">
                            Total: <span id="macro-total">100</span>%
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="goals-cancel-btn" class="secondary-btn">Cancelar</button>
                <button id="goals-save-btn" class="primary-btn">Guardar objetivos</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        // Configuración de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCVcltJ9MKV-9JtXL9ELYes8veODV-Qwfk",
            authDomain: "nutriscan-app.firebaseapp.com",
            projectId: "nutriscan-app",
            storageBucket: "nutriscan-app.appspot.com",
            messagingSenderId: "145682529339",
            appId: "1:145682529339:web:12b1e3c7e2df68355feb94",
            measurementId: "G-0LHVTMCYS5"
        };
        
        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        
        // Registrar Service Worker para PWA
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('service-worker.js')
                .then(function(registration) {
                    console.log('Service Worker registrado con éxito:', registration);
                })
                .catch(function(error) {
                    console.log('Error al registrar el Service Worker:', error);
                });
        }
        
        // Variable global para el objetivo seleccionado
        window.selectedGoal = null;
    </script>
    
    <!-- Cargar módulos principales como tipo module -->
    <script src="js/models/database.js" type="module"></script>
    <script src="js/models/user-preferences.js" type="module"></script>
    <script src="js/models/nutritional-info.js" type="module"></script>
    <script src="js/models/calorie-tracker.js" type="module"></script>
    <script src="js/models/statistics.js" type="module"></script>
    <script src="js/models/workout-recommendations.js" type="module"></script>
    <script src="js/models/barcode-scanner.js" type="module"></script>
    <script src="js/camera.js" type="module"></script>
    <script src="js/profile.js" type="module"></script>
    <script src="js/app.js" type="module"></script>
    <script src="js/init.js" type="module"></script>
    <script src="js/auth.js" type="module"></script>
</body>
</html>
